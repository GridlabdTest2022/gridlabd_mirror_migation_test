#!/bin/bash
# 
# This script generates a list of the makefile that must be included to build the gridlabd package
#

PATHNAME=$1
SOURCE=${PATHNAME%/*}
FILENAME=${PATHNAME##*/}
INCLUDE=${SOURCE:-.}/makefile.inc
test "$SOURCE" == "$FILENAME" && SOURCE=.
echo "# gridlabd make configuration" > $INCLUDE
# echo "# COMMAND = $0 $* " >> $INCLUDE
# echo "# UPDATED = $(date)" >> $INCLUDE
# echo "# SOURCE = $SOURCE" >> $INCLUDE
# echo "# FILENAME = $FILENAME" >> $INCLUDE
for MAKEFILE in $(find ${SOURCE:-.} -name $FILENAME -print); do
	FOLDER=${MAKEFILE%/*}
	if [ "$MAKEFILE" != "$PATHNAME" ]; then
		NAME=$(echo "${FOLDER/$SOURCE\//}" | tr -c A-Za-z _ | tr a-z A-Z)
		echo "" >> $INCLUDE
		echo "# $FOLDER" >> $INCLUDE
		echo "${NAME}CFLAGS = \$(CFLAGS) \$(CPPFLAGS) \$(CXXFLAGS)" >> $INCLUDE
		echo "${NAME}LDFLAGS = \$(LDFLAGS)" >> $INCLUDE
		echo "${NAME}ARFLAGS = \$(ARFLAGS)" >> $INCLUDE
		echo "${NAME}SOFLAGS = \$(SOFLAGS)" >> $INCLUDE
		echo "${NAME}SOURCES = " >> $INCLUDE
		echo "${NAME}HEADERS = " >> $INCLUDE
		echo "${NAME}OBJECTS = " >> $INCLUDE
		echo "${NAME}PARAMS = " >> $INCLUDE
		echo "include $MAKEFILE" >> $INCLUDE
	fi
done

echo $INCLUDE
